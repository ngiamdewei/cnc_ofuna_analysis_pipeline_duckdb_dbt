{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.0", "generated_at": "2025-12-26T05:54:19.245683Z", "invocation_id": "120779c6-ee2a-4e92-9ca4-8367fa0811a3", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:28.754702Z", "completed_at": "2025-12-26T05:53:28.764673Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:28.765669Z", "completed_at": "2025-12-26T05:53:30.489924Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.741227388381958, "adapter_response": {"_message": "SELECT 325136", "code": "SELECT", "rows_affected": 325136}, "message": "SELECT 325136", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.stage_raw_cnc_ofuna", "compiled": true, "compiled_code": "\n\nselect\n  -- keep the clean staging columns (downstream expects these)\n  monitor_machineno,\n  \"TimeStamp_SGT\",\n  \"TimeStamp_UTC\",\n  \"Quality\" as status,\n  \"Value\" as value,\n  \"PointName\" as pointname,\n  \"OpcTag\",\n  \"OpcTag\" as opctag,\n  monitor_diameter,\n  monitor_elapsed,\n  monitor_phdt,\n  monitor_progress,\n  \"SpindleFieldRaw\",\n  monitor_spindle,\n  machine_state_ofuna,\n  alarm_content,\n  alarm_alarmcode,\n  \"StatusErrorCode\" as StatusErrorCode,\n  monitor_program,\n  machinestate,\n  monitor_toolno,\n  monitor_nu,\n\n  -- add \u201craw-contract\u201d aliases (your stage tests expect these)\n  monitor_machineno::int    as machine_no,\n  \"TimeStamp_SGT\"           as timestamp_sgt,\n  \"TimeStamp_UTC\"           as timestamp_utc,\n--   \"PointName\"               as pointname,\n  now()::timestamp          as ingested_at\n\n\nfrom \"cnc_ofuna_dev\".\"raw\".\"vw_OFUNA_84_TO_91_STAGING_CLEAN_duckdb\"\n\n", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:30.517842Z", "completed_at": "2025-12-26T05:53:30.533802Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:30.534800Z", "completed_at": "2025-12-26T05:53:30.938325Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.4254598617553711, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.accepted_values_stage_raw_cnc_ofuna_machine_no__084__085__086__087__088__089__090__091.807ea655c2", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        machine_no as value_field,\n        count(*) as n_records\n\n    from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n    group by machine_no\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    '084','085','086','087','088','089','090','091'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:30.522831Z", "completed_at": "2025-12-26T05:53:30.534800Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:30.553257Z", "completed_at": "2025-12-26T05:53:30.953800Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.43994641304016113, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_stage_raw_cnc_ofuna_ingested_at.8aea8976ea", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ingested_at\nfrom \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\nwhere ingested_at is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:30.945823Z", "completed_at": "2025-12-26T05:53:30.956792Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:30.957788Z", "completed_at": "2025-12-26T05:53:31.206047Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2632181644439697, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_stage_raw_cnc_ofuna_machine_no.daddcbcb22", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect machine_no\nfrom \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\nwhere machine_no is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:30.965767Z", "completed_at": "2025-12-26T05:53:30.972749Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:30.972749Z", "completed_at": "2025-12-26T05:53:31.214026Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.25823450088500977, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_stage_raw_cnc_ofuna_timestamp_sgt.daf34582bb", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect timestamp_sgt\nfrom \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\nwhere timestamp_sgt is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:31.215023Z", "completed_at": "2025-12-26T05:53:31.223005Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:31.224003Z", "completed_at": "2025-12-26T05:53:31.413523Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.2044835090637207, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_stage_raw_cnc_ofuna_timestamp_utc.ab03b758a6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect timestamp_utc\nfrom \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\nwhere timestamp_utc is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:31.425492Z", "completed_at": "2025-12-26T05:53:31.434523Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:31.434523Z", "completed_at": "2025-12-26T05:53:31.925823Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.5073130130767822, "adapter_response": {"_message": "SELECT 48", "code": "SELECT", "rows_affected": 48}, "message": "SELECT 48", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.int_ofuna_production_cycles", "compiled": true, "compiled_code": "with progress_ordered as (\n    select\n        monitor_machineno,\n        \"TimeStamp_SGT\" as timestamp_sgt,\n        \"TimeStamp_UTC\" as timestamp_utc,\n        monitor_program,\n        monitor_progress,\n        lag(monitor_progress) over (\n            partition by monitor_machineno\n            order by timestamp_utc\n        ) as prev_progress\n    from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n    where monitor_progress is not null\n),\n\ncycle_markers as (\n    select\n        monitor_machineno,\n        timestamp_sgt,\n        timestamp_utc,\n        monitor_program,\n        monitor_progress,\n        case\n            when monitor_progress > 0 and (prev_progress is null or prev_progress = 0) then 1\n            else 0\n        end as is_cycle_start\n    from progress_ordered\n),\n\ncycle_ids as (\n    select\n        monitor_machineno,\n        timestamp_sgt,\n        timestamp_utc,\n        monitor_program,\n        monitor_progress,\n        sum(is_cycle_start) over (\n            partition by monitor_machineno\n            order by timestamp_utc\n            rows unbounded preceding\n        ) as cycle_seq\n    from cycle_markers\n),\n\ncycle_ranges as (\n    select\n        monitor_machineno,\n        cycle_seq,\n        min(timestamp_sgt) as cycle_start_sgt,\n        max(monitor_program) as monitor_program\n    from cycle_ids\n    where cycle_seq > 0\n    group by monitor_machineno, cycle_seq\n),\n\ncycle_with_end as (\n    select\n        c.monitor_machineno,\n        c.cycle_seq,\n        c.monitor_program,\n        c.cycle_start_sgt,\n        lead(c.cycle_start_sgt) over (\n            partition by c.monitor_machineno\n            order by c.cycle_start_sgt\n        ) as cycle_end_sgt\n    from cycle_ranges c\n),\n\nfinal as (\n    select\n        (cycle_start_sgt::date) as production_day,\n        monitor_machineno,\n        monitor_program,\n        cycle_start_sgt,\n        cycle_end_sgt,\n        extract(epoch from (cycle_end_sgt - cycle_start_sgt))::int as cycle_duration_s,\n        round((extract(epoch from (cycle_end_sgt - cycle_start_sgt)) / 60.0)::numeric, 2) as cycle_duration_mins,\n        round((extract(epoch from (cycle_end_sgt - cycle_start_sgt)) / 3600.0)::numeric, 2) as cycle_duration_hrs,\n        (cycle_end_sgt is not null) as production_hitscountfinish,\n        (cycle_end_sgt is not null) as production_endtimefinish,\n        cycle_seq as production_cycle_id\n    from cycle_with_end\n)\n\nselect *\nfrom final\nwhere (cycle_end_sgt is null or cycle_duration_s >= 0)", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"int_ofuna_production_cycles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:31.934804Z", "completed_at": "2025-12-26T05:53:31.940787Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:31.941785Z", "completed_at": "2025-12-26T05:53:32.639565Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.7077522277832031, "adapter_response": {"_message": "SELECT 3192", "code": "SELECT", "rows_affected": 3192}, "message": "SELECT 3192", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.int_ofuna_tools_nu_deltas", "compiled": true, "compiled_code": "with base as (\n    select\n        monitor_machineno,\n        \"TimeStamp_SGT\" as ts_start,\n        \"TimeStamp_UTC\" as timestamp_utc,\n        (\"TimeStamp_SGT\"::date) as production_day,\n        monitor_nu as nu\n    from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n    where monitor_nu is not null\n),\n\nnonzero as (\n    select\n        monitor_machineno,\n        production_day,\n        ts_start,\n        timestamp_utc,\n        nu,\n        lag(nu) over (\n            partition by monitor_machineno\n            order by timestamp_utc\n        ) as prev_nu\n    from base\n    where nu > 0\n),\n\ndeltas as (\n    select\n        monitor_machineno,\n        production_day,\n        ts_start,\n        timestamp_utc,\n        lead(ts_start) over (\n            partition by monitor_machineno\n            order by timestamp_utc\n        ) as ts_end,\n        nu,\n        prev_nu,\n        case\n            when prev_nu is null then 0\n            when nu <= prev_nu then 0\n            else nu - prev_nu\n        end as nu_delta\n    from nonzero\n)\n\nselect\n    monitor_machineno,\n    production_day,\n    ts_start,\n    ts_end,\n    nu,\n    prev_nu,\n    nu_delta\nfrom deltas", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"int_ofuna_tools_nu_deltas\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:31.420506Z", "completed_at": "2025-12-26T05:53:31.429517Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:31.430513Z", "completed_at": "2025-12-26T05:53:35.861074Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.442563056945801, "adapter_response": {"_message": "SELECT 325136", "code": "SELECT", "rows_affected": 325136}, "message": "SELECT 325136", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.int_cnc_ofuna", "compiled": true, "compiled_code": "with b as (\n  select\n    lpad(machine_no::text, 3, '0')                   as monitor_machineno,\n    timestamp_sgt                                    as \"TimeStamp_SGT\",\n    timestamp_utc                                    as \"TimeStamp_UTC\",\n    status                                           as \"Quality\",\n    value                                            as \"Value\",\n    pointname                                        as \"PointName\",\n    regexp_replace(pointname, '^.*\\.', '')           as \"OpcTag\"\n  from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n),\n\nbase_calc as (\n  select\n    b.*,\n\n    -- Diameter (TRY_CONVERT(float, Value)/1000)\n    case\n      when \"OpcTag\" = 'Diameter' and \"Value\" ~ '^-?\\d+(\\.\\d+)?$'\n      then (\"Value\"::double precision) / 1000.0\n    end as monitor_diameter,\n\n    -- AR runtime from Status -> monitor_elapsed (seconds)\n    case\n      when \"OpcTag\" = 'Status'\n       and position('AR' in \"Value\") > 0\n       and substring(\"Value\" from position('AR' in \"Value\") + 2 for 8) ~ '^\\d{2}:\\d{2}:\\d{2}$'\n      then extract(epoch from (\n        (substring(\"Value\" from position('AR' in \"Value\") + 2 for 8)::time)\n        - time '00:00:00'\n      ))::int\n    end as monitor_elapsed,\n\n    -- AH hit counter -> monitor_phdt\n    case\n      when \"OpcTag\" = 'Status'\n       and position('AH' in \"Value\") > 0\n      then nullif(ltrim(substring(\"Value\" from position('AH' in \"Value\") + 2 for 7)), '')::int\n    end as monitor_phdt,\n\n    -- AP progress -> monitor_progress\n    case\n      when \"OpcTag\" = 'Status'\n       and position('AP' in \"Value\") > 0\n      then nullif(ltrim(substring(\"Value\" from position('AP' in \"Value\") + 2 for 3)), '')::int\n    end as monitor_progress\n\n  from b\n),\n\nzs_extract as (\n  select\n    bc.*,\n\n    -- SpindleFieldRaw: substring ZS... until next comma\n    case\n      when \"OpcTag\" = 'Status' and position('ZS' in \"Value\") > 0\n      then (regexp_match(\"Value\", '(ZS[^,]*)'))[1]\n    end as \"SpindleFieldRaw\",\n\n    case\n      when \"OpcTag\" = 'Status' and position('ZS' in \"Value\") > 0\n      then right((regexp_match(\"Value\", '(ZS[^,]*)'))[1], 6)\n    end as monitor_spindle,\n\n    -- machine_state_ofuna: token MO...\n    case\n      when \"OpcTag\" = 'Status' and position(',MO' in \"Value\") > 0\n      then (regexp_match(\"Value\", ',(MO[^,]*)'))[1]\n    end as machine_state_ofuna\n\n  from base_calc bc\n),\n\nalarm_parse as (\n  select\n    z.*,\n\n    -- StatusErrorCode: EC token\n    case\n      when \"OpcTag\" = 'Status' and position(',EC' in \"Value\") > 0\n      then (regexp_match(\"Value\", ',(EC[^,]*)'))[1]\n    end as \"StatusErrorCode\",\n\n    -- monitor_program: substring after \",FN\"\n    case\n      when \"OpcTag\" = 'Status' and position(',FN' in \"Value\") > 0\n      then substring(\"Value\" from position(',FN' in \"Value\") + 3 for 255)\n    end as monitor_program,\n\n    -- machinestate\n    case\n      when \"OpcTag\" = 'MachineState' and \"Value\" ~ '^\\s*\\d+\\s*$'\n      then \"Value\"::int\n    end as machinestate,\n\n    -- tool no from Tools tag (T...)\n    case\n      when \"OpcTag\" = 'Tools' and position('T' in \"Value\") > 0\n      then nullif((regexp_match(\"Value\", 'T([0-9]+)'))[1], '')::int\n    end as monitor_toolno,\n\n    -- NU from Tools tag (NU...)\n    case\n      when \"OpcTag\" = 'Tools' and position('NU' in \"Value\") > 0\n      then nullif((regexp_match(\"Value\", 'NU([0-9]+)'))[1], '')::int\n    end as monitor_nu\n\n  from zs_extract z\n),\n\nalarm_positions as (\n  select\n    a.*,\n    a.\"Value\"::text as vval,\n    position(' * ' in a.\"Value\") as star_block,\n    position('*' in a.\"Value\") as star_any,\n    case\n      when position(';' in reverse(a.\"Value\")) > 0\n      then length(a.\"Value\") - position(';' in reverse(a.\"Value\")) + 1\n      else 0\n    end as semi_last_any\n  from alarm_parse a\n),\n\nalarm_final as (\n  select\n    p.*,\n    case\n      when p.star_block > 0 then p.star_block + 1\n      when p.star_any > 0 then p.star_any\n      else 0\n    end as star_idx\n  from alarm_positions p\n),\n\nalarm_final2 as (\n  select\n    af.*,\n    case\n      when af.\"OpcTag\" = 'Error'\n       and af.semi_last_any > af.star_idx\n      then af.semi_last_any\n      else 0\n    end as semi_last_pos\n  from alarm_final af\n)\n\nselect\n  monitor_machineno,\n  \"TimeStamp_SGT\",\n  \"TimeStamp_UTC\",\n  \"Quality\",\n  \"Value\",\n  \"PointName\",\n  \"OpcTag\",\n  monitor_diameter,\n  monitor_elapsed,\n  monitor_phdt,\n  monitor_progress,\n  \"SpindleFieldRaw\",\n  monitor_spindle,\n  machine_state_ofuna,\n\n  -- alarm_content/alarm_alarmcode exactly like MSSQL logic\n  case\n    when \"OpcTag\" = 'Error' and semi_last_pos > 0 and star_idx > 0\n    then btrim(substring(\"Value\" from (star_idx + 1) for (semi_last_pos - (star_idx + 1))))\n  end as alarm_content,\n\n  case\n    when \"OpcTag\" = 'Error' and semi_last_pos > 0\n    then nullif(substring(\"Value\" from (semi_last_pos + 1) for 20), '')::int\n  end as alarm_alarmcode,\n\n  \"StatusErrorCode\",\n  monitor_program,\n  machinestate,\n  monitor_toolno,\n  monitor_nu\nfrom alarm_final2", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"int_cnc_ofuna\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:35.866095Z", "completed_at": "2025-12-26T05:53:35.872048Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:35.872048Z", "completed_at": "2025-12-26T05:53:36.574699Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.7105617523193359, "adapter_response": {"_message": "SELECT 8", "code": "SELECT", "rows_affected": 8}, "message": "SELECT 8", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.mart_ofuna_monitor_snapshot", "compiled": true, "compiled_code": "with recent as (\n    select\n        monitor_machineno,\n        timestamp_utc,\n        timestamp_sgt,\n        opctag,\n        monitor_elapsed,\n        monitor_progress,\n        monitor_phdt,\n        monitor_diameter,\n        monitor_spindle,\n        machine_state_ofuna,\n        monitor_program,\n        alarm_alarmcode,\n        StatusErrorCode,\n        machinestate\n    from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n),\n\n\nmachines as (\n    select lpad(gs::text, 3, '0')::varchar(20) as monitor_machineno\n    from generate_series(84, 91) gs\n),\n\nlatest_status as (\n    select *\n    from (\n        select r.*,\n               row_number() over (partition by r.monitor_machineno order by r.timestamp_sgt desc) as rn\n        from recent r\n        where r.opctag = 'Status'\n    ) x\n    where rn = 1\n),\n\nlatest_error as (\n    select *\n    from (\n        select \n         e.*,\n         e.timestamp_sgt as alarm_start_sgt,\n         row_number() over (partition by e.monitor_machineno order by e.timestamp_sgt desc) as rn\n        from recent e\n        join latest_status s\n          on s.monitor_machineno = e.monitor_machineno\n         and e.opctag = 'Error'\n         and e.timestamp_sgt <= s.timestamp_sgt\n        where e.alarm_alarmcode is not null\n    ) x\n    where rn = 1\n),\n\nlatest_diameter as (\n    select monitor_machineno, monitor_diameter\n    from (\n        select d.*,\n               row_number() over (partition by d.monitor_machineno order by d.timestamp_sgt desc) as rn\n        from recent d\n        where d.opctag='Diameter'\n          and d.monitor_diameter is not null\n          and d.monitor_diameter > 0\n    ) x\n    where rn=1\n),\n\njoined as (\n    select\n        m.monitor_machineno,\n\n        s.timestamp_sgt,\n        s.monitor_elapsed,\n        s.monitor_progress,\n        s.monitor_phdt,\n        coalesce(d.monitor_diameter, s.monitor_diameter) as monitor_diameter,\n        s.monitor_spindle,\n        s.monitor_program,\n        s.machine_state_ofuna,\n        s.StatusErrorCode,\n        s.machinestate,\n        e.alarm_alarmcode,\n        e.alarm_start_sgt\n    from machines m\n    left join latest_status s on s.monitor_machineno = m.monitor_machineno\n    left join latest_error  e on e.monitor_machineno = m.monitor_machineno\n    left join latest_diameter d on d.monitor_machineno = m.monitor_machineno\n),\n\nstatus_calc as (\n    select\n        j.*,\n        case\n            when j.monitor_machineno is null then null\n            when j.machine_state_ofuna = 'MOWORK' and j.monitor_elapsed > 0 then 2\n            when j.alarm_alarmcode is not null and j.machine_state_ofuna in ('MOSTOP','MOALAM') then 1\n            when j.alarm_alarmcode is not null and j.machine_state_ofuna in ('MOWAIT','MOIDLE') then 6\n            when j.monitor_progress between 1 and 99 then 2\n            when j.monitor_progress >= 100 then 2\n            when j.monitor_progress is null and j.monitor_elapsed > 0 then 2\n            when j.monitor_progress = 0 and j.monitor_elapsed > 0 then 2\n            else null\n        end as monitor_status,\n        case\n          when j.timestamp_sgt is null or j.monitor_elapsed is null then null\n          else (j.timestamp_sgt - (j.monitor_elapsed * interval '1 second'))\n        end as monitor_start\n    from joined j\n)\n\n\nselect\n    -- =========================================================\n    -- 18 \u201cPower BI / Viamech base\u201d columns FIRST (name + type)\n    -- =========================================================\n    monitor_machineno::varchar(20)                 as monitor_machineno,\n    timestamp_sgt::timestamp                       as monitor_timelog,\n    null::varchar(256)                             as monitor_type,\n    monitor_status::int                            as monitor_status,\n    monitor_spindle::varchar(6)                    as monitor_spindle,\n    null::int                                      as monitor_sp,\n    null::int                                      as monitor_mode,\n    monitor_program::varchar(256)                  as monitor_program,\n    monitor_start                                  as monitor_start,\n    monitor_elapsed::int                           as monitor_elapsed,\n    monitor_progress::int                          as monitor_progress,\n    monitor_phdt::int                              as monitor_phdt,\n    monitor_diameter::real                         as monitor_diameter,\n    case\n      when monitor_phdt is null or monitor_progress is null or monitor_progress <= 0 then null\n      else floor(monitor_phdt * (100.0 - monitor_progress) / monitor_progress)::int\n    end                                            as monitor_remain,\n    alarm_alarmcode::varchar(6)                    as monitor_alarmcode,\n    null::int                                      as monitor_ps,\n    null::int                                      as monitor_sr,\n    null::int                                      as monitor_pr,\n    -- =========================================================\n    -- EXTRA columns AFTER base (safe to keep)\n    -- =========================================================\n    CASE\n        WHEN monitor_elapsed IS NULL THEN NULL\n        ELSE TO_CHAR(INTERVAL '1 second' * monitor_elapsed,'HH24:MI:SS')\n    END as elapsed_time,\n    (\n        CASE\n            WHEN monitor_progress IS NULL or monitor_progress = 0 THEN NULL\n            ELSE 100 * monitor_elapsed / monitor_progress\n        END\n    ) as total_time\n    ,\n    (\n        CASE\n            WHEN monitor_progress IS NULL  or monitor_progress = 0 THEN NULL\n            ELSE (100 * monitor_elapsed / monitor_progress - monitor_elapsed)\n        END\n    ) as remaining_seconds\n    ,\n    (\n        CASE\n            WHEN monitor_progress IS NULL OR  monitor_progress = 0 THEN NULL\n            ELSE TO_CHAR(INTERVAL '1 second' * (100 * monitor_elapsed / monitor_progress - monitor_elapsed),'HH24:MI:SS')\n        END\n    ) as remaining_time\n    ,\n    CASE\n        WHEN alarm_alarmcode IS NULL OR alarm_start_sgt IS NULL THEN NULL\n        ELSE (CURRENT_TIMESTAMP(0) - alarm_start_sgt)\n    END as alarm_elapsed_time,\n    CASE\n        WHEN monitor_progress IS NULL OR monitor_progress < 100\n        OR monitor_elapsed IS NULL OR monitor_start IS NULL\n        THEN NULL\n        ELSE (monitor_start + (monitor_elapsed || ' seconds')::interval)\n    END as end_time,\n    -- (\n    --     monitor_start + (monitor_elapsed || ' seconds')::interval\n    -- ) as end_time\n    CASE\n        WHEN monitor_progress IS NULL OR monitor_progress < 100\n        OR monitor_elapsed IS NULL OR monitor_start IS NULL\n        THEN NULL\n        ELSE (CURRENT_TIMESTAMP(0) - (monitor_start + (monitor_elapsed || ' seconds')::interval))\n    END as elapsed_end_time,\n    CASE\n        WHEN monitor_progress IS NULL OR monitor_progress < 100\n        OR monitor_elapsed IS NULL OR monitor_start IS NULL\n        THEN NULL\n        ELSE EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP(0) - (monitor_start + (monitor_elapsed || ' seconds')::interval)))\n    END as elapsed_end_time_seconds,\n    case monitor_status\n      when 1 then 'Stopping'\n      when 2 then 'Working'\n      when 6 then 'Waiting'\n    end                                            as monitor_status_desc,\n    machinestate                                   as \"Machine Status\",\n    StatusErrorCode                                as StatusErrorCode,\n    machine_state_ofuna                            as machine_state_ofuna_dbg\nfrom status_calc", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_monitor_snapshot\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:36.581652Z", "completed_at": "2025-12-26T05:53:36.642549Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:36.643559Z", "completed_at": "2025-12-26T05:53:39.161537Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.582913637161255, "adapter_response": {"_message": "SELECT 1056", "code": "SELECT", "rows_affected": 1056}, "message": "SELECT 1056", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.mart_ofuna_util", "compiled": true, "compiled_code": "with base as (\n    select\n        monitor_machineno,\n        timestamp_sgt::timestamp  as ts_sgt,\n        timestamp_utc             as ts_utc,\n        machine_state_ofuna,\n        monitor_nu\n    from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n),\n\n\n-- 1) MachineState events (expect val like 'MOWORK','MOWAIT','MOIDLE','MOSTOP','MOALAM')\nstate_events as (\n    select\n        monitor_machineno,\n        ts_sgt,\n        machine_state_ofuna\n    from base\n    where machine_state_ofuna is not null\n),\n\n-- 2) Convert to segments using LEAD()\nsegments as (\n    select\n        monitor_machineno,\n        ts_sgt as segment_start_sgt,\n        lead(ts_sgt) over (partition by monitor_machineno order by ts_sgt) as segment_end_sgt,\n        machine_state_ofuna\n    from state_events\n),\n\n-- 3) Clamp segments to same-day (and clamp open-ended segment to now or midnight)\nsegments_day as (\n    select\n        monitor_machineno,\n        segment_start_sgt,\n        case\n            when segment_end_sgt is null then\n                case\n                    when segment_start_sgt::date = (now() at time zone 'Asia/Singapore')::date\n                        then (now() at time zone 'Asia/Singapore')::timestamp\n                    else date_trunc('day', segment_start_sgt) + interval '1 day'\n                end\n            when segment_start_sgt::date = segment_end_sgt::date then segment_end_sgt\n            else date_trunc('day', segment_start_sgt) + interval '1 day'\n        end as segment_end_sgt_eff,\n        case\n            when machine_state_ofuna = 'MOWORK' then 'WORK'\n            when machine_state_ofuna in ('MOWAIT','MOIDLE') then 'WAIT'\n            when machine_state_ofuna in ('MOSTOP','MOALAM') then 'STOP'\n            else 'OTHER'\n        end as segment_state\n    from segments\n    where segment_start_sgt is not null\n),\n\n-- 4) Build (day, machine) grid\ndays_machines as (\n    select distinct\n        segment_start_sgt::date as utilization_day,\n        monitor_machineno       as utilization_machineno\n    from segments_day\n),\n\n-- 5) Create 48 half-hour buckets per day\nnums as (\n    select generate_series(0,47) as n\n),\n\nbuckets as (\n    select\n        dm.utilization_day,\n        (dm.utilization_day::timestamp + (n.n * interval '30 minutes'))::time as utilization_time,\n        dm.utilization_machineno,\n        (dm.utilization_day::timestamp + (n.n * interval '30 minutes'))       as bucket_start,\n        (dm.utilization_day::timestamp + ((n.n+1) * interval '30 minutes'))   as bucket_end\n    from days_machines dm\n    cross join nums n\n),\n\n-- 6) Compute overlaps (seconds) between segments and buckets\nseg_overlaps as (\n    select\n        b.utilization_day,\n        b.utilization_time,\n        b.utilization_machineno,\n        s.segment_state,\n        case\n            when s.segment_start_sgt < b.bucket_end\n             and s.segment_end_sgt_eff > b.bucket_start\n            then extract(epoch from (\n                    least(s.segment_end_sgt_eff, b.bucket_end)\n                  - greatest(s.segment_start_sgt, b.bucket_start)\n                 ))::int\n            else 0\n        end as overlap_s\n    from buckets b\n    left join segments_day s\n      on s.monitor_machineno = b.utilization_machineno\n     and s.segment_start_sgt::date = b.utilization_day\n),\n\nagg_state as (\n    select\n        utilization_day,\n        utilization_time,\n        utilization_machineno,\n        sum(case when segment_state in ('WORK','WAIT','STOP') then overlap_s else 0 end)::int as poweron_s,\n        sum(case when segment_state = 'WORK' then overlap_s else 0 end)::int               as working_s,\n        sum(case when segment_state = 'WAIT' then overlap_s else 0 end)::int               as waiting_s,\n        sum(case when segment_state = 'STOP' then overlap_s else 0 end)::int               as stopping_s\n    from seg_overlaps\n    group by 1,2,3\n),\n\n-- 7) Optional: NU deltas -> hitscount per half-hour\nnu_events as (\n    select\n        monitor_machineno,\n        ts_sgt,\n        monitor_nu::bigint as nu\n    from base\n    where monitor_nu is not null\n),\n\nnu_deltas as (\n    select\n        monitor_machineno,\n        ts_sgt,\n        nu,\n        lag(nu) over (partition by monitor_machineno order by ts_sgt) as prev_nu\n    from nu_events\n),\n\nnu_bucket as (\n    select\n        ts_sgt::date as utilization_day,\n        (date_trunc('hour', ts_sgt) + (extract(minute from ts_sgt)::int / 30) * interval '30 minutes')::time as utilization_time,\n        monitor_machineno as utilization_machineno,\n        sum(\n            case\n                when prev_nu is null then 0\n                when nu >= prev_nu then (nu - prev_nu)\n                else 0\n            end\n        )::int as hits_nu\n    from nu_deltas\n    where nu is not null\n    group by 1,2,3\n)\n\nselect\n    -- =========================================================\n    -- BASE 9 cols FIRST (Power BI \u201cSELECT *\u201d stable)\n    -- =========================================================\n    a.utilization_day::date                  as utilization_day,\n    a.utilization_time::time                 as utilization_time,\n    a.utilization_machineno::varchar(20)     as utilization_machineno,\n    a.poweron_s::int                         as utilization_poweron,\n    a.working_s::int                         as utilization_working,\n    a.waiting_s::int                         as utilization_waiting,\n    a.stopping_s::int                        as utilization_stopping,\n    (6 * a.working_s)::int                   as utilization_spindle,\n    coalesce(n.hits_nu, 0)::int              as utilization_hitscount,\n\n    -- =========================================================\n    -- EXTRAS (safe at end)\n    -- =========================================================\n    (a.utilization_day + a.utilization_time)::timestamp                     as utilization_datetime,\n    (1800 - a.poweron_s)::int                as utilization_poweroff,\n    to_char(interval '1 second' * (1800 - a.poweron_s), 'HH24:MI:SS')        as poweroff_time,\n    to_char(interval '1 second' * a.poweron_s,           'HH24:MI:SS')       as poweron_time,\n    to_char(interval '1 second' * a.stopping_s,          'HH24:MI:SS')       as stopping_time,\n    to_char(interval '1 second' * a.working_s,           'HH24:MI:SS')       as working_time,\n    to_char(interval '1 second' * a.waiting_s,           'HH24:MI:SS')       as waiting_time\nfrom agg_state a\nleft join nu_bucket n\n  on n.utilization_day = a.utilization_day\n and n.utilization_time = a.utilization_time\n and n.utilization_machineno = a.utilization_machineno", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_util\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:39.168521Z", "completed_at": "2025-12-26T05:53:39.175510Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:39.175510Z", "completed_at": "2025-12-26T05:53:39.321761Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1572253704071045, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.accepted_values_int_ofuna_production_cycles_monitor_machineno__084__085__086__087__088__089__090__091.91e12d67dc", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        monitor_machineno as value_field,\n        count(*) as n_records\n\n    from \"cnc_ofuna_dev\".\"raw\".\"int_ofuna_production_cycles\"\n    group by monitor_machineno\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    '084','085','086','087','088','089','090','091'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:39.330705Z", "completed_at": "2025-12-26T05:53:39.339681Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:39.339681Z", "completed_at": "2025-12-26T05:53:39.461518Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1358339786529541, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_int_ofuna_tools_nu_deltas_monitor_machineno.f2186e7024", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect monitor_machineno\nfrom \"cnc_ofuna_dev\".\"raw\".\"int_ofuna_tools_nu_deltas\"\nwhere monitor_machineno is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:39.468544Z", "completed_at": "2025-12-26T05:53:39.476514Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:39.477479Z", "completed_at": "2025-12-26T05:53:39.598688Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.13314437866210938, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_int_ofuna_tools_nu_deltas_production_day.997bdf7977", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect production_day\nfrom \"cnc_ofuna_dev\".\"raw\".\"int_ofuna_tools_nu_deltas\"\nwhere production_day is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:39.608661Z", "completed_at": "2025-12-26T05:53:39.619662Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:39.620630Z", "completed_at": "2025-12-26T05:53:39.760814Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15661287307739258, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_int_ofuna_tools_nu_deltas_ts_start.4bb2130b5c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ts_start\nfrom \"cnc_ofuna_dev\".\"raw\".\"int_ofuna_tools_nu_deltas\"\nwhere ts_start is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:39.768309Z", "completed_at": "2025-12-26T05:53:39.778282Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:39.779280Z", "completed_at": "2025-12-26T05:53:40.192366Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.42904162406921387, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.accepted_values_int_cnc_ofuna_monitor_machineno__084__085__086__087__088__089__090__091.3ede32c7dc", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        monitor_machineno as value_field,\n        count(*) as n_records\n\n    from \"cnc_ofuna_dev\".\"raw\".\"int_cnc_ofuna\"\n    group by monitor_machineno\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    '084','085','086','087','088','089','090','091'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:40.202334Z", "completed_at": "2025-12-26T05:53:40.212309Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:40.213307Z", "completed_at": "2025-12-26T05:53:40.361510Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.16116762161254883, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.accepted_values_mart_ofuna_monitor_snapshot_monitor_machineno__084__085__086__087__088__089__090__091.827f202bf1", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        monitor_machineno as value_field,\n        count(*) as n_records\n\n    from \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_monitor_snapshot\"\n    group by monitor_machineno\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    '084','085','086','087','088','089','090','091'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:40.371004Z", "completed_at": "2025-12-26T05:53:40.378984Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:40.379982Z", "completed_at": "2025-12-26T05:53:40.522136Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1551222801208496, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_mart_ofuna_util_utilization_day.e83aa45252", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect utilization_day\nfrom \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_util\"\nwhere utilization_day is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:40.532108Z", "completed_at": "2025-12-26T05:53:40.541084Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:40.542080Z", "completed_at": "2025-12-26T05:53:40.680687Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15356779098510742, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_mart_ofuna_util_utilization_machineno.549c66acbb", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect utilization_machineno\nfrom \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_util\"\nwhere utilization_machineno is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:40.690663Z", "completed_at": "2025-12-26T05:53:40.699639Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:40.699639Z", "completed_at": "2025-12-26T05:53:40.822832Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.13616037368774414, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_mart_ofuna_util_utilization_time.f326c6cda4", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect utilization_time\nfrom \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_util\"\nwhere utilization_time is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:53:32.667007Z", "completed_at": "2025-12-26T05:53:32.676980Z"}, {"name": "execute", "started_at": "2025-12-26T05:53:32.677978Z", "completed_at": "2025-12-26T05:54:18.474146Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 45.811110496520996, "adapter_response": {"_message": "SELECT 941", "code": "SELECT", "rows_affected": 941}, "message": "SELECT 941", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.mart_ofuna_alarm", "compiled": true, "compiled_code": "with src as (\n  select\n    monitor_machineno,\n    timestamp_sgt,\n    timestamp_utc,\n    machine_state_ofuna,\n    monitor_program,\n    alarm_alarmcode,\n    alarm_content\n  from \"cnc_ofuna_dev\".\"raw\".\"stage_raw_cnc_ofuna\"\n),\n\nstate_ordered as (\n  select\n    s.*,\n    lag(s.machine_state_ofuna) over (\n      partition by s.monitor_machineno\n      order by s.timestamp_sgt\n    ) as prev_state\n  from src s\n  where s.machine_state_ofuna is not null    \n),\n\n\nsegments as (\n  select\n    monitor_machineno,\n    timestamp_sgt as segment_start_sgt,\n    lead(timestamp_sgt) over (partition by monitor_machineno order by timestamp_sgt) as segment_end_sgt,\n    machine_state_ofuna,\n    prev_state,\n    monitor_program,\n    timestamp_utc\n  from state_ordered\n  where machine_state_ofuna in ('MOWAIT','MOIDLE','MOSTOP','MOALAM')\n    and (prev_state is null or prev_state <> machine_state_ofuna)\n),\n\nseg_alarm as (\n  select\n    sg.*,\n    al.alarm_alarmcode as seg_alarmcode,\n    al.alarm_content   as seg_alarmcontent\n  from segments sg\n  left join lateral (\n    select a.alarm_alarmcode, a.alarm_content\n    from src a\n    where a.monitor_machineno = sg.monitor_machineno\n      and a.alarm_alarmcode is not null\n      and a.timestamp_sgt <= sg.segment_start_sgt\n    order by a.timestamp_utc desc\n    limit 1\n  ) al on true\n),\n\ndur as (\n  select\n    *,\n    case when segment_end_sgt is null then null\n         else extract(epoch from (segment_end_sgt - segment_start_sgt))::int\n    end as duration_s\n  from seg_alarm\n)\n\nselect\n  -- =========================================================\n  -- 10 base columns FIRST (so downstream stays stable)\n  -- NOTE: alarm_continue is varchar(1) so Power BI filter = 'T' works\n  -- =========================================================\n  segment_start_sgt::date               as alarm_Day,\n  monitor_machineno::varchar(20)        as machine_Code,\n  seg_alarmcode::varchar(6)             as alarm_Code,\n  seg_alarmcontent                      as alarm_Msg,\n  null as Alarm_Level,\n  segment_start_sgt::timestamp          as alarm_Start,\n  segment_end_sgt::timestamp            as alarm_End,\n  0::int                                as alarm_workingtime,\n  case when machine_state_ofuna in ('MOWAIT','MOIDLE')\n       then coalesce(duration_s,0) else 0 end::int\n                                       as alarm_waitingtime,\n  case when machine_state_ofuna in ('MOSTOP','MOALAM')\n       then coalesce(duration_s,0) else 0 end::int\n                                       as alarm_stoppingtime,\n  case when machine_state_ofuna in ('MOSTOP','MOALAM') then 1\n       when machine_state_ofuna in ('MOWAIT','MOIDLE') then 6\n       else null end::int                as alarm_machinestate,\n  case when segment_end_sgt is null then 'T' else 'F' end::varchar(1)\n                                       as alarm_continue,\n  -- (Alarm_End - Alarm_Start) as \"Duration(HH:mm:ss)\",\n  case\n    when segment_end_sgt is null then null\n    else (segment_end_sgt - segment_start_sgt)\n  end                                   as \"Duration(HH:mm:ss)\",\n  duration_s as \"Duration(s)\",\n  -- =========================================================\n  -- EXTRA columns AFTER base\n  -- =========================================================\n  monitor_program,\n  prev_state,\n  timestamp_utc                           as timestamp_utc_dbg,\n  'NCdrill'::text                         as \"Machine Type\"\n\nfrom dur\nwhere seg_alarmcode is not null", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_alarm\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:54:18.481091Z", "completed_at": "2025-12-26T05:54:18.486076Z"}, {"name": "execute", "started_at": "2025-12-26T05:54:18.487105Z", "completed_at": "2025-12-26T05:54:18.620277Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1431741714477539, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.accepted_values_mart_ofuna_alarm_machine_Code__084__085__086__087__088__089__090__091.984d9547db", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        machine_Code as value_field,\n        count(*) as n_records\n\n    from \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_alarm\"\n    group by machine_Code\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    '084','085','086','087','088','089','090','091'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-26T05:54:18.629255Z", "completed_at": "2025-12-26T05:54:18.635236Z"}, {"name": "execute", "started_at": "2025-12-26T05:54:18.636234Z", "completed_at": "2025-12-26T05:54:18.829812Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.20354986190795898, "adapter_response": {"_message": "SELECT 48", "code": "SELECT", "rows_affected": 48}, "message": "SELECT 48", "failures": null, "unique_id": "model.cnc_ofuna_analysis_dbt.mart_ofuna_production", "compiled": true, "compiled_code": "with cycles as (\n    select\n        monitor_machineno,\n        production_cycle_id,\n        production_day,\n        monitor_program,\n        cycle_start_sgt,\n        cycle_end_sgt\n    from \"cnc_ofuna_dev\".\"raw\".\"int_ofuna_production_cycles\"\n),\n\ncycle_nu as (\n    select\n        c.monitor_machineno,\n        c.production_cycle_id,\n        c.production_day,\n        c.monitor_program,\n        c.cycle_start_sgt,\n        c.cycle_end_sgt,\n        coalesce(sum(nu.nu_delta), 0) as production_hitscount\n    from cycles c\n    left join \"cnc_ofuna_dev\".\"raw\".\"int_ofuna_tools_nu_deltas\" nu\n      on nu.monitor_machineno = c.monitor_machineno\n     and nu.ts_start >= c.cycle_start_sgt\n     and (c.cycle_end_sgt is null or nu.ts_start < c.cycle_end_sgt)\n    group by\n        c.monitor_machineno,\n        c.production_cycle_id,\n        c.production_day,\n        c.monitor_program,\n        c.cycle_start_sgt,\n        c.cycle_end_sgt\n),\n\ncycle_alarms as (\n    select\n        c.monitor_machineno,\n        c.production_cycle_id,\n        coalesce(sum(a.alarm_waitingtime), 0)  as production_waitingtime,\n        coalesce(sum(a.alarm_stoppingtime), 0) as production_stoppingtime,\n        coalesce(count(*), 0)                  as production_alarmcount\n    from cycles c\n    left join \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_alarm\" a\n      on a.machine_code = c.monitor_machineno\n     and a.alarm_start >= c.cycle_start_sgt\n     and (c.cycle_end_sgt is null or a.alarm_end <= c.cycle_end_sgt)\n    group by\n        c.monitor_machineno,\n        c.production_cycle_id\n)\n\nselect\n    n.production_day::date                                   as production_day,\n    n.monitor_machineno::varchar(20)                          as production_machineno,\n    n.monitor_program::varchar(50)                            as production_progname,\n    n.cycle_start_sgt::timestamp                              as production_starttime,\n    n.cycle_end_sgt::timestamp                                as production_endtime,\n    n.production_hitscount::int                               as production_hitscount,\n    case\n        when n.cycle_end_sgt is null then null\n        else (\n            extract(epoch from (n.cycle_end_sgt - n.cycle_start_sgt))::int\n            - coalesce(a.production_waitingtime, 0)\n            - coalesce(a.production_stoppingtime, 0)\n        )\n    end                                                       as production_processtime,\n    coalesce(a.production_waitingtime, 0)::int                as production_waitiingtime,\n    coalesce(a.production_stoppingtime, 0)::int               as production_stoppingtime,\n    coalesce(a.production_alarmcount, 0)::int                 as production_alarmcount,\n    (n.cycle_end_sgt is not null)                             as production_hitscountfinish,\n    (n.cycle_end_sgt is not null)                             as production_endtimefinish,\n    n.cycle_end_sgt::timestamp                                as production_timelog\nfrom cycle_nu n\nleft join cycle_alarms a\n  on a.monitor_machineno = n.monitor_machineno\n and a.production_cycle_id = n.production_cycle_id", "relation_name": "\"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_production\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:54:18.836693Z", "completed_at": "2025-12-26T05:54:18.848667Z"}, {"name": "execute", "started_at": "2025-12-26T05:54:18.848667Z", "completed_at": "2025-12-26T05:54:18.992320Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.15862321853637695, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_mart_ofuna_production_production_day.a62275900e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect production_day\nfrom \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_production\"\nwhere production_day is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:54:18.843680Z", "completed_at": "2025-12-26T05:54:18.848667Z"}, {"name": "execute", "started_at": "2025-12-26T05:54:18.851689Z", "completed_at": "2025-12-26T05:54:19.019247Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1855480670928955, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_mart_ofuna_production_production_machineno.ef0e2af70d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect production_machineno\nfrom \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_production\"\nwhere production_machineno is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-26T05:54:19.003292Z", "completed_at": "2025-12-26T05:54:19.010272Z"}, {"name": "execute", "started_at": "2025-12-26T05:54:19.011304Z", "completed_at": "2025-12-26T05:54:19.125483Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.12917256355285645, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.cnc_ofuna_analysis_dbt.not_null_mart_ofuna_production_production_starttime.3b91b95d35", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect production_starttime\nfrom \"cnc_ofuna_dev\".\"raw\".\"mart_ofuna_production\"\nwhere production_starttime is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 51.01969003677368, "args": {"defer": false, "select": ["stage_raw_cnc_ofuna+"], "source_freshness_run_project_hooks": false, "require_nested_cumulative_type_params": false, "macro_debugging": false, "export_saved_queries": false, "resource_types": [], "warn_error_options": {"include": [], "exclude": []}, "state_modified_compare_more_unrendered_values": false, "log_file_max_bytes": 10485760, "profiles_dir": "..\\profiles", "require_batched_execution_for_custom_microbatch_strategy": false, "introspect": true, "strict_mode": false, "favor_state": false, "version_check": true, "target": "local_pg", "partial_parse_file_diff": true, "log_format": "default", "state_modified_compare_vars": false, "partial_parse": true, "print": true, "quiet": false, "skip_nodes_if_on_run_start_fails": false, "show_resource_report": false, "exclude_resource_types": [], "which": "build", "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors_file": true, "require_yaml_configuration_for_mf_time_spines": false, "log_format_file": "debug", "project_dir": "C:\\Users\\5963\\Desktop\\health monitoring\\cnc_ofuna_analysis_pipeline_duckdb_dbt\\dbt", "invocation_command": "dbt build --profiles-dir ..\\profiles --target local_pg -s stage_raw_cnc_ofuna+ --full-refresh", "send_anonymous_usage_stats": false, "log_level": "info", "static_parser": true, "printer_width": 80, "exclude": [], "show": false, "empty": false, "vars": {}, "populate_cache": true, "write_json": true, "full_refresh": true, "log_path": "C:\\Users\\5963\\Desktop\\health monitoring\\cnc_ofuna_analysis_pipeline_duckdb_dbt\\dbt\\logs", "use_colors": true, "include_saved_query": false, "indirect_selection": "eager", "require_resource_names_without_spaces": false, "cache_selected_only": false, "log_level_file": "debug"}}